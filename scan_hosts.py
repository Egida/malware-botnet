import subprocess
import ipaddress

def execute_command(command):
    process = subprocess.Popen(command,
                        stdout=subprocess.PIPE, 
                        stderr=subprocess.PIPE)

    stdout, stderr = process.communicate()

    return stdout.decode('utf-8'), stderr.decode('utf-8')

ipconfig_output, ipconfig_err  = execute_command(['ipconfig'])

adapters = []
adapter_num = -1
for line in ipconfig_output.splitlines():
    if "adapter" in line:
        adapter_num += 1
        adapters.append({})
    elif adapter_num >= 0:
        splitted_line = line.split(':', 1)
        if len(splitted_line) == 2:
            key, value = splitted_line
            adapters[adapter_num][key.replace('.', '').strip()] = value.strip()

for a in adapters[1::]:
    ipv4 = a.get('IPv4 Address')
    mask = a.get('Subnet Mask')
    if ipv4 and mask:
        interface = ipaddress.ip_interface('{}/{}'.format(ipv4, mask))
        ips_list = [str(ip) for ip in ipaddress.IPv4Network(interface.network)]

        for ip in ips_list:
            ping_output, ping_err = execute_command(['ping', ip, '-i', '1', '-n', '1', '-w', '1'])
            if "bytes=32" in ping_output:
                print("Alive host: {}".format(ip))
            # else:
            #     print("Dead host: {}".format(ip))
    

